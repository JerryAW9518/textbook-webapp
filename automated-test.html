<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ‹å°å­¸ç¿’å°å¹«æ‰‹ - è‡ªå‹•åŒ–æ¸¬è©¦</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans TC', -apple-system, sans-serif;
      background: linear-gradient(135deg, #F5F1E8 0%, #E8E4DC 100%);
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      color: #5A5A52;
      margin-bottom: 30px;
      font-size: 32px;
    }

    .test-controls {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .test-controls button {
      background: #9CAF88;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .test-controls button:hover {
      background: #8A9B7A;
    }

    .test-controls button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .progress {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .progress-bar {
      width: 100%;
      height: 30px;
      background: #E8E4DC;
      border-radius: 15px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #9CAF88 0%, #A4B8C4 100%);
      transition: width 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    .results {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .test-item {
      padding: 12px;
      margin-bottom: 8px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .test-item.pending {
      background: #f5f5f5;
      color: #999;
    }

    .test-item.running {
      background: #FFF9E6;
      color: #856404;
      animation: pulse 1s infinite;
    }

    .test-item.passed {
      background: #E8F5E9;
      color: #2E7D32;
    }

    .test-item.failed {
      background: #FFEBEE;
      color: #C62828;
    }

    .test-icon {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .test-name {
      flex: 1;
      font-weight: 500;
    }

    .test-time {
      font-size: 12px;
      color: #999;
    }

    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }

    .summary-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }

    .summary-value {
      font-size: 36px;
      font-weight: 700;
      margin: 10px 0;
    }

    .summary-label {
      color: #999;
      font-size: 14px;
    }

    .summary-card.total .summary-value { color: #5A5A52; }
    .summary-card.passed .summary-value { color: #2E7D32; }
    .summary-card.failed .summary-value { color: #C62828; }
    .summary-card.rate .summary-value { color: #9CAF88; }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .log {
      background: #f5f5f5;
      padding: 12px;
      border-radius: 8px;
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }

    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid #ddd;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-entry.error {
      color: #C62828;
    }

    .log-entry.success {
      color: #2E7D32;
    }

    .log-entry.info {
      color: #1976D2;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª åœ‹å°å­¸ç¿’å°å¹«æ‰‹ - è‡ªå‹•åŒ–æ¸¬è©¦å¥—ä»¶</h1>

    <div class="test-controls">
      <button id="startBtn">é–‹å§‹æ¸¬è©¦</button>
      <button id="stopBtn" disabled>åœæ­¢æ¸¬è©¦</button>
      <button id="clearBtn">æ¸…é™¤çµæœ</button>
      <button id="exportBtn">åŒ¯å‡ºå ±å‘Š</button>
    </div>

    <div class="progress">
      <h3 style="margin-bottom: 12px;">æ¸¬è©¦é€²åº¦</h3>
      <div class="progress-bar">
        <div class="progress-fill" id="progressBar">0%</div>
      </div>
    </div>

    <div class="summary">
      <div class="summary-card total">
        <div class="summary-label">ç¸½æ¸¬è©¦æ•¸</div>
        <div class="summary-value" id="totalTests">0</div>
      </div>
      <div class="summary-card passed">
        <div class="summary-label">é€šé</div>
        <div class="summary-value" id="passedTests">0</div>
      </div>
      <div class="summary-card failed">
        <div class="summary-label">å¤±æ•—</div>
        <div class="summary-value" id="failedTests">0</div>
      </div>
      <div class="summary-card rate">
        <div class="summary-label">é€šéç‡</div>
        <div class="summary-value" id="passRate">0%</div>
      </div>
    </div>

    <div class="results">
      <h3 style="margin-bottom: 16px;">æ¸¬è©¦çµæœ</h3>
      <div id="testResults"></div>
    </div>

    <div class="log" id="logContainer">
      <strong>æ¸¬è©¦æ—¥èªŒ:</strong>
      <div id="logContent"></div>
    </div>
  </div>

  <script>
    // æ¸¬è©¦å®šç¾©
    const tests = [
      {
        name: 'æª¢æŸ¥é–‹ç™¼æœå‹™å™¨é‹è¡Œä¸­',
        test: async () => {
          const response = await fetch('http://localhost:3000');
          return response.ok;
        }
      },
      {
        name: 'è¼‰å…¥åœ‹æ–‡-ç¿°æ—æ˜ å°„æ–‡ä»¶',
        test: async () => {
          const response = await fetch('/data/mandarin/hanlin.json');
          const data = await response.json();
          return typeof data === 'object' && data !== null;
        }
      },
      {
        name: 'è¼‰å…¥æ•¸å­¸-åº·è»’æ˜ å°„æ–‡ä»¶',
        test: async () => {
          const response = await fetch('/data/math/kangxuan.json');
          const data = await response.json();
          return typeof data === 'object' && data !== null;
        }
      },
      {
        name: 'æ¸¬è©¦åœ‹æ–‡ç­”æ¡ˆæ–‡ä»¶ (ç¿°æ—11-1)',
        test: async () => {
          const response = await fetch('/data/mandarin/hanlin/hanlin11/hanlin11_1.json');
          const data = await response.json();
          return Array.isArray(data) && data.length > 0;
        }
      },
      {
        name: 'æ¸¬è©¦æ•¸å­¸ç­”æ¡ˆæ–‡ä»¶ (åº·è»’12-1)',
        test: async () => {
          const response = await fetch('/data/math/kangxuan/kangxuan12/kangxuan12_1.json');
          const data = await response.json();
          return Array.isArray(data) && data.length > 0;
        }
      },
      {
        name: 'é©—è­‰ vocabulary é¡Œå‹çµæ§‹',
        test: async () => {
          const response = await fetch('/data/mandarin/hanlin/hanlin11/hanlin11_1.json');
          const data = await response.json();
          const hasVocab = data.some(section =>
            section.question && section.question.some(q => q.category === 'vocabulary')
          );
          return hasVocab;
        }
      },
      {
        name: 'é©—è­‰ vocabularyZhuyin é¡Œå‹çµæ§‹',
        test: async () => {
          const response = await fetch('/data/mandarin/hanlin/hanlin12/hanlin12_1.json');
          const data = await response.json();
          const hasZhuyin = data.some(section =>
            section.question && section.question.some(q =>
              q.category === 'vocabularyZhuyin' && q.zhuyin
            )
          );
          return hasZhuyin;
        }
      },
      {
        name: 'é©—è­‰ equation é¡Œå‹çµæ§‹',
        test: async () => {
          const response = await fetch('/data/math/hanlin/hanlin11/hanlin11_6.json');
          const data = await response.json();
          let hasEquation = false;
          data.forEach(section => {
            if (section.section) {
              section.section.forEach(subsection => {
                if (subsection.question) {
                  subsection.question.forEach(q => {
                    if (q.answers) {
                      q.answers.forEach(a => {
                        if (a.category === 'equation') hasEquation = true;
                      });
                    }
                  });
                }
              });
            }
          });
          return hasEquation;
        }
      },
      {
        name: 'é©—è­‰ tex (LaTeX) é¡Œå‹çµæ§‹',
        test: async () => {
          const response = await fetch('/data/math/hanlin/hanlin41/hanlin41_4.json');
          const data = await response.json();
          let hasTex = false;
          data.forEach(section => {
            if (section.section) {
              section.section.forEach(subsection => {
                if (subsection.question) {
                  subsection.question.forEach(q => {
                    if (q.answers) {
                      q.answers.forEach(a => {
                        if (a.category === 'tex') hasTex = true;
                      });
                    }
                  });
                }
              });
            }
          });
          return hasTex;
        }
      },
      {
        name: 'é©—è­‰ checkbox é¡Œå‹çµæ§‹',
        test: async () => {
          const response = await fetch('/data/math/hanlin/hanlin12/hanlin12_2.json');
          const data = await response.json();
          let hasCheckbox = false;
          data.forEach(section => {
            if (section.section) {
              section.section.forEach(subsection => {
                if (subsection.question) {
                  subsection.question.forEach(q => {
                    if (q.answers) {
                      q.answers.forEach(a => {
                        if (a.category === 'checkbox') hasCheckbox = true;
                      });
                    }
                  });
                }
              });
            }
          });
          return hasCheckbox;
        }
      },
      {
        name: 'æ¸¬è©¦ä¿®å¾©çš„æ–‡ä»¶ (hanlin12_4.json)',
        test: async () => {
          const response = await fetch('/data/mandarin/hanlin/hanlin12/hanlin12_4.json');
          const data = await response.json();
          return Array.isArray(data);
        }
      },
      {
        name: 'éš¨æ©Ÿæ¸¬è©¦ 10 å€‹åœ‹æ–‡æ–‡ä»¶',
        test: async () => {
          const testFiles = [
            '/data/mandarin/nanone/nanone21/nanone21_1.json',
            '/data/mandarin/kangxuan/kangxuan31/kangxuan31_2.json',
            '/data/mandarin/hanlin/hanlin42/hanlin42_3.json',
            '/data/mandarin/nanone/nanone52/nanone52_5.json',
            '/data/mandarin/kangxuan/kangxuan61/kangxuan61_7.json',
          ];

          for (const file of testFiles) {
            const response = await fetch(file);
            if (!response.ok) return false;
            const data = await response.json();
            if (!Array.isArray(data)) return false;
          }
          return true;
        }
      },
      {
        name: 'éš¨æ©Ÿæ¸¬è©¦ 10 å€‹æ•¸å­¸æ–‡ä»¶',
        test: async () => {
          const testFiles = [
            '/data/math/hanlin/hanlin21/hanlin21_1.json',
            '/data/math/kangxuan/kangxuan32/kangxuan32_3.json',
            '/data/math/nanone/nanone41/nanone41_5.json',
            '/data/math/hanlin/hanlin52/hanlin52_7.json',
            '/data/math/kangxuan/kangxuan62/kangxuan62_9.json',
          ];

          for (const file of testFiles) {
            const response = await fetch(file);
            if (!response.ok) return false;
            const data = await response.json();
            if (!Array.isArray(data)) return false;
          }
          return true;
        }
      }
    ];

    // æ¸¬è©¦ç‹€æ…‹
    let testResults = [];
    let isRunning = false;

    // UI å…ƒç´ 
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const clearBtn = document.getElementById('clearBtn');
    const exportBtn = document.getElementById('exportBtn');
    const progressBar = document.getElementById('progressBar');
    const testResultsEl = document.getElementById('testResults');
    const logContent = document.getElementById('logContent');

    // æ—¥èªŒå‡½æ•¸
    function log(message, type = 'info') {
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logContent.appendChild(entry);
      logContent.parentElement.scrollTop = logContent.parentElement.scrollHeight;
    }

    // æ›´æ–°çµ±è¨ˆ
    function updateStats() {
      const total = testResults.length;
      const passed = testResults.filter(r => r.status === 'passed').length;
      const failed = testResults.filter(r => r.status === 'failed').length;
      const rate = total > 0 ? Math.round((passed / total) * 100) : 0;

      document.getElementById('totalTests').textContent = total;
      document.getElementById('passedTests').textContent = passed;
      document.getElementById('failedTests').textContent = failed;
      document.getElementById('passRate').textContent = rate + '%';
    }

    // æ›´æ–°é€²åº¦æ¢
    function updateProgress() {
      const total = tests.length;
      const completed = testResults.filter(r => r.status !== 'running').length;
      const percent = Math.round((completed / total) * 100);
      progressBar.style.width = percent + '%';
      progressBar.textContent = percent + '%';
    }

    // æ¸²æŸ“æ¸¬è©¦çµæœ
    function renderResults() {
      testResultsEl.innerHTML = testResults.map((result, index) => `
        <div class="test-item ${result.status}">
          <span class="test-icon">
            ${result.status === 'passed' ? 'âœ…' :
              result.status === 'failed' ? 'âŒ' :
              result.status === 'running' ? 'â³' : 'â¸ï¸'}
          </span>
          <span class="test-name">${result.name}</span>
          ${result.time ? `<span class="test-time">${result.time}ms</span>` : ''}
        </div>
      `).join('');
    }

    // åŸ·è¡Œå–®å€‹æ¸¬è©¦
    async function runTest(test, index) {
      const startTime = Date.now();
      testResults[index].status = 'running';
      renderResults();
      log(`é–‹å§‹æ¸¬è©¦: ${test.name}`, 'info');

      try {
        const result = await test.test();
        const time = Date.now() - startTime;

        testResults[index].status = result ? 'passed' : 'failed';
        testResults[index].time = time;

        if (result) {
          log(`âœ… é€šé: ${test.name} (${time}ms)`, 'success');
        } else {
          log(`âŒ å¤±æ•—: ${test.name} (${time}ms)`, 'error');
        }
      } catch (error) {
        const time = Date.now() - startTime;
        testResults[index].status = 'failed';
        testResults[index].time = time;
        testResults[index].error = error.message;
        log(`âŒ éŒ¯èª¤: ${test.name} - ${error.message}`, 'error');
      }

      renderResults();
      updateStats();
      updateProgress();
    }

    // é–‹å§‹æ¸¬è©¦
    async function startTests() {
      if (isRunning) return;

      isRunning = true;
      startBtn.disabled = true;
      stopBtn.disabled = false;

      // åˆå§‹åŒ–çµæœ
      testResults = tests.map(t => ({
        name: t.name,
        status: 'pending',
        time: null
      }));

      renderResults();
      log('ğŸš€ é–‹å§‹åŸ·è¡Œæ¸¬è©¦å¥—ä»¶...', 'info');

      // ä¾åºåŸ·è¡Œæ¸¬è©¦
      for (let i = 0; i < tests.length; i++) {
        if (!isRunning) break;
        await runTest(tests[i], i);
        await new Promise(resolve => setTimeout(resolve, 100)); // çŸ­æš«å»¶é²
      }

      isRunning = false;
      startBtn.disabled = false;
      stopBtn.disabled = true;

      const passed = testResults.filter(r => r.status === 'passed').length;
      const total = testResults.length;
      log(`âœ¨ æ¸¬è©¦å®Œæˆï¼é€šé ${passed}/${total} (${Math.round(passed/total*100)}%)`, 'success');
    }

    // åœæ­¢æ¸¬è©¦
    function stopTests() {
      isRunning = false;
      stopBtn.disabled = true;
      startBtn.disabled = false;
      log('â¹ï¸ æ¸¬è©¦å·²åœæ­¢', 'info');
    }

    // æ¸…é™¤çµæœ
    function clearResults() {
      testResults = [];
      logContent.innerHTML = '';
      testResultsEl.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">å°šæœªé–‹å§‹æ¸¬è©¦</p>';
      updateStats();
      updateProgress();
      log('ğŸ—‘ï¸ çµæœå·²æ¸…é™¤', 'info');
    }

    // åŒ¯å‡ºå ±å‘Š
    function exportReport() {
      const report = {
        timestamp: new Date().toISOString(),
        summary: {
          total: testResults.length,
          passed: testResults.filter(r => r.status === 'passed').length,
          failed: testResults.filter(r => r.status === 'failed').length,
          passRate: Math.round((testResults.filter(r => r.status === 'passed').length / testResults.length) * 100)
        },
        results: testResults
      };

      const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `test-report-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);

      log('ğŸ“¥ å ±å‘Šå·²åŒ¯å‡º', 'success');
    }

    // äº‹ä»¶ç›£è½
    startBtn.addEventListener('click', startTests);
    stopBtn.addEventListener('click', stopTests);
    clearBtn.addEventListener('click', clearResults);
    exportBtn.addEventListener('click', exportReport);

    // åˆå§‹åŒ–
    clearResults();
    log('âœ… æ¸¬è©¦å¥—ä»¶å·²å°±ç·’', 'success');
  </script>
</body>
</html>
